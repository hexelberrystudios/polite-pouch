var politePouch=function(t,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r,"function"!=typeof Object.assign&&(Object.assign=function(t){for(var r=Object(t),n=1;n<arguments.length;n++){var e=arguments[n];if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r});for(var n=Object.assign,e=[],o=0;o<256;++o)e[o]=(o+256).toString(16).substr(1);var i=function(t,r){var n=r||0,o=e;return o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]};var u,a,c,f=(u=80,a=function(t){return"function"==typeof Buffer.from?Array.isArray(t)?t=Buffer.from(t):"string"==typeof t&&(t=Buffer.from(t,"utf8")):Array.isArray(t)?t=new Buffer(t):"string"==typeof t&&(t=new Buffer(t,"utf8")),r.createHash("sha1").update(t).digest()},(c=function(t,r,n,e){var o=n&&e||0;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));for(var r=new Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}(t)),"string"==typeof r&&(r=function(t){var r=[];return t.replace(/[a-fA-F0-9]{2}/g,function(t){r.push(parseInt(t,16))}),r}(r)),!Array.isArray(t))throw TypeError("value must be an array of bytes");if(!Array.isArray(r)||16!==r.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=a(r.concat(t));if(c[6]=15&c[6]|u,c[8]=63&c[8]|128,n)for(var f=0;f<16;++f)n[o+f]=c[f];return n||i(c)}).name="v5",c.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",c.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",c);function s(){return(new Date).toISOString()}function d(t){return t.createdAt?t.updatedAt=s():t.createdAt=s(),t._deleted&&(t.deletedAt=t.deletedAt||t.updatedAt),t}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function v(t){return null===t.id.match(/^_design/)}function p(t){return"object"===(void 0===t?"undefined":l(t))?t._id:t}function y(t,r,n){var e=p(r);return n&&e.substr(0,n.length)!==n&&(e=n+e),t.get(e).catch(function(t){var r=void 0;throw 404===t.status?((r=new Error('Object with id "'+e+'" is missing')).name="Not found",r.status=404,r):t})}function h(t,r,n){var e=r.map(p);return n&&(e=e.map(function(t){return t.substr(0,n.length)===n?t:n+t})),t.allDocs({keys:e,include_docs:!0}).then(function(t){var r=t.rows.reduce(function(t,r){return t[r.id]=r.doc,t},{});return e.map(function(t){var n=r[t];if(n)return n;var e=new Error('Object with id "'+t+'" is missing');return e.name="Not found",e.status=404,e})})}function m(t,r){return"object"===(void 0===t?"undefined":l(t))?n(r,t):t(r),r}function b(t,r,e,o){var i=void 0;return"string"!=typeof r||e?y(t,r,o).then(function(t){return e?m(e,t):n(t,r,{_id:t._id,_rev:t._rev})}).then(function(r){return i=r,t.put(d(i))}).then(function(t){return i._rev=t.rev,i}):Promise.reject("Document must be a JSON object")}function _(t,r,e,o){var i=void 0,u=r.map(function(t){var r=p(t);return o&&r.substr(0,o.length)!==o&&(r=o+r),r});return h(t,u,o).then(function(t){return e?t.map(function(t){return t instanceof Error?t:m(e,t)}):t.map(function(t,e){var o=r[e];return t instanceof Error?t:"object"!==(void 0===o?"undefined":l(o))?Promise.reject("Document must be a JSON object"):n(t,o,{_id:t._id,_rev:t._rev})})}).then(function(r){var n=void 0;return(n=(i=r).filter(function(t){return!(t instanceof Error)})).forEach(d),t.bulkDocs(n)}).then(function(t){return t.forEach(function(t){var r=u.indexOf(t.id);i[r]._rev=t.rev}),i})}function A(t,r){var e="string"==typeof r?{_id:r}:r;return t&&m(t,e),n({_deleted:!0},e)}var g={pleaseAdd:function(t,r){return Array.isArray(t)?function(t,r,e){return r=r.map(function(t){return d(t=n({},t))}),e&&r.forEach(function(t){t._id=e+(t._id||f())}),t.bulkDocs(r).then(function(t){return t.map(function(t,n){var e=void 0;return t instanceof Error?409===t.status?((e=new Error('Object with id "'+r[n]._id+'" already exists')).name="Conflict",e.status=409,e):t:(r[n]._id=t.id,r[n]._rev=t.rev,r[n])})})}(this,t,r):function(t,r,e){return"object"!==(void 0===r?"undefined":l(r))?Promise.reject("Document must be a JSON object"):((r=n({},r))._id||(r._id=f()),e&&(r._id=e+r._id),r=d(r),t.put(r).then(function(t){return r._id=t.id,r._rev=t.rev,r}).catch(function(t){var n=void 0;throw 409===t.status?((n=new Error('Object with id "'+r._id+'" already exists')).name="Conflict",n.status=409,n):t}))}(this,t,r)},pleaseClear:function(){return this.destroy()},pleaseFindAll:function(t,r){var n={include_docs:!0};return r&&(n.startkey=r,n.endkey=r+"￿"),this.allDocs(n).then(function(r){var n=r.rows.filter(v).map(function(t){return t.doc});return"function"==typeof t?n.filter(t):n})},pleaseFind:function(t,r){return Array.isArray(t)?h(this,t,r):y(this,t,r)},pleaseRemoveAll:function(t,r){var n=void 0,e={include_docs:!0};return r&&(e.startkey=r,e.endkey=r+"￿"),this.allDocs(e).then(function(r){return n=r.rows.filter(v).map(function(t){return t.doc}),"function"==typeof t&&(n=n.filter(t)),n.map(function(t){return t._deleted=!0,d(t)})}).then(this.bulkDocs.bind(this)).then(function(t){return t.map(function(t,r){return n[r]._rev=t.rev,n[r]})})},pleaseRemove:function(t,r,n){return Array.isArray(t)?_(this,t.map(A.bind(null,r)),null,n):b(this,A(r,t),null,n)},pleaseUpdate:function(t,r,n){return"object"===(void 0===t?"undefined":l(t))||r?Array.isArray(t)?_(this,t,r,n):b(this,t,r,n):Promise.reject(new Error("Must provide change"))}};return t.politePouch=g,t}({},crypto);
